<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§å®¶å±…åº«å­˜ç³»çµ± v3.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.47/dist/vue.global.js"></script>
    <style>
        body { background-color: #f8f9fa; font-family: "Microsoft JhengHei", sans-serif; padding-bottom: 80px; /* é ç•™åº•éƒ¨æµ®å‹•åˆ—ç©ºé–“ */ }
        .card { box-shadow: 0 4px 6px rgba(0,0,0,0.05); border: none; margin-bottom: 15px; }
        .status-low { color: #dc3545; font-weight: bold; }
        .status-ok { color: #198754; }
        .nav-link.active { background-color: #0d6efd !important; color: white !important; }
        [v-cloak] { display: none; }
        .table-responsive { overflow-x: auto; }
        /* è¡¨æ ¼æ¨£å¼å„ªåŒ– */
        .table > tbody > tr > td { vertical-align: middle; }
        .category-tag { font-size: 0.75rem; padding: 2px 6px; background: #e9ecef; border-radius: 4px; color: #666; display: inline-block; margin-bottom: 2px;}
        .item-name { font-weight: 500; }
        .price-tag { font-size: 0.85rem; color: #198754; }
        
        /* æµ®å‹•æ“ä½œåˆ—æ¨£å¼ */
        .floating-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            gap: 15px;
            z-index: 1000;
            align-items: center;
            border: 1px solid #eee;
            min-width: 300px;
            justify-content: space-around;
        }
        .floating-btn {
            border: none;
            background: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem;
            color: #555;
            cursor: pointer;
            transition: color 0.2s;
        }
        .floating-btn i { font-size: 1.2rem; margin-bottom: 2px; }
        .floating-btn:hover { color: #0d6efd; }
        .floating-btn.disabled { color: #ccc; pointer-events: none; }

        /* å‹¾é¸æ¡†æ¨£å¼æ”¾å¤§ */
        .form-check-input { width: 1.3em; height: 1.3em; cursor: pointer; border-color: #999;}
        
        /* æœå°‹æ¡†æ¨£å¼ */
        .search-box { position: relative; }
        .search-box i { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: #999; }
        .search-box input { padding-left: 35px; border-radius: 20px; }
    </style>
</head>
<body>

<div id="app" class="container py-3" v-cloak>
    <h4 class="mb-3 text-center fw-bold">ğŸ  æ™ºæ…§å®¶å±…åº«å­˜ v3.0</h4>

    <ul class="nav nav-pills mb-3 justify-content-center nav-justified bg-white p-1 rounded shadow-sm">
        <li class="nav-item"><a class="nav-link" :class="{active: currentTab === 'inventory'}" @click="currentTab = 'inventory'" href="#">ğŸ“¦ åº«å­˜ç¸½è¡¨</a></li>
        <li class="nav-item"><a class="nav-link" :class="{active: currentTab === 'pricewatch'}" @click="currentTab = 'pricewatch'" href="#">ğŸ’° æ ¼åƒ¹/åŒ¯å…¥</a></li>
        <li class="nav-item"><a class="nav-link" :class="{active: currentTab === 'utility'}" @click="currentTab = 'utility'" href="#">âš¡ æ°´é›»ç…¤</a></li>
        <li class="nav-item"><a class="nav-link" :class="{active: currentTab === 'settings'}" @click="currentTab = 'settings'" href="#">âš™ï¸ è¨­å®š</a></li>
    </ul>

    <div v-if="currentTab === 'inventory'">
        <div class="card p-3 mb-3 sticky-top" style="z-index: 900; background: rgba(255,255,255,0.95); backdrop-filter: blur(5px);">
            <div class="search-box">
                <i class="bi bi-search"></i>
                <input v-model="searchQuery" type="text" class="form-control" placeholder="æœå°‹åç¨±ã€åˆ†é¡ã€åƒ¹æ ¼æˆ–æ¢ç¢¼...">
            </div>
            <div class="d-flex justify-content-between mt-2 align-items-center">
                <span class="small text-muted">å…± {{ filteredInventory.length }} é …ç‰©å“</span>
                <button v-if="selectedItems.length > 0" @click="selectAll(false)" class="btn btn-sm btn-link text-decoration-none text-danger">å–æ¶ˆå…¨é¸</button>
            </div>
        </div>

        <div class="card p-0 overflow-hidden">
            <div class="table-responsive">
                <table class="table table-hover mb-0 text-nowrap">
                    <thead class="table-light">
                        <tr>
                            <th class="ps-3">ç‰©å“è³‡è¨Š</th>
                            <th class="text-center">åº«å­˜/åƒ¹æ ¼</th>
                            <th class="text-center" style="width: 50px;">é¸å–</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item, index) in filteredInventory" :key="item.id" :class="{'table-active': isSelected(item)}">
                            <td class="ps-3" @click="toggleSelection(item)">
                                <span class="category-tag">{{ getCategoryName(item.categoryId) }}</span>
                                <div class="item-name text-truncate" style="max-width: 180px;">{{ item.name }}</div>
                                <div class="small text-muted" v-if="item.isbn">Code: {{ item.isbn }}</div>
                                <a v-if="item.url" :href="item.url" target="_blank" @click.stop class="badge bg-light text-secondary border mt-1 text-decoration-none">ç¶²åº—é€£çµ <i class="bi bi-box-arrow-up-right"></i></a>
                            </td>
                            <td class="text-center">
                                <div class="btn-group btn-group-sm mb-1">
                                    <button @click.stop="updateStock(item, -1)" class="btn btn-outline-secondary px-2">-</button>
                                    <button class="btn btn-light disabled text-dark fw-bold border-top border-bottom" style="width:35px">{{ item.stock }}</button>
                                    <button @click.stop="updateStock(item, 1)" class="btn btn-outline-success px-2">+</button>
                                </div>
                                <div v-if="item.latestPrice" class="price-tag">
                                    ${{ item.latestPrice }} <span class="text-muted" style="font-size:0.7em">({{ item.unitPrice }})</span>
                                </div>
                            </td>
                            <td class="text-center" @click="toggleSelection(item)">
                                <input type="checkbox" class="form-check-input" :checked="isSelected(item)">
                            </td>
                        </tr>
                        <tr v-if="filteredInventory.length === 0">
                            <td colspan="3" class="text-center py-5 text-muted">
                                <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                                æ‰¾ä¸åˆ°ç›¸é—œç‰©å“
                                <br>
                                <button @click="showAddModal = true" class="btn btn-primary btn-sm mt-2">æ‰‹å‹•æ–°å¢ä¸€å€‹</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div v-if="selectedItems.length === 0" style="position: fixed; bottom: 25px; right: 25px; z-index: 999;">
            <button @click="showAddModal = true" class="btn btn-primary rounded-circle shadow p-0" style="width: 56px; height: 56px; font-size: 24px;">
                <i class="bi bi-plus-lg"></i>
            </button>
        </div>

        <div v-if="selectedItems.length > 0" class="floating-bar">
            <button @click="actionEdit" class="floating-btn" :class="{disabled: selectedItems.length > 1}">
                <i class="bi bi-pencil-square"></i> ç·¨è¼¯
            </button>
            <button @click="actionCopy" class="floating-btn">
                <i class="bi bi-clipboard"></i> è¤‡è£½
            </button>
            <button @click="actionWhatsApp" class="floating-btn text-success">
                <i class="bi bi-whatsapp"></i> WhatsApp
            </button>
            <button @click="actionCSV" class="floating-btn">
                <i class="bi bi-file-earmark-spreadsheet"></i> CSV
            </button>
            <button @click="actionDelete" class="floating-btn text-danger">
                <i class="bi bi-trash"></i> åˆªé™¤
            </button>
        </div>
    </div>

    <div v-if="currentTab === 'pricewatch'">
        <div class="card p-3 border-warning mb-3">
            <h5 class="text-warning-emphasis"><i class="bi bi-robot"></i> Gemini JSON åŒ¯å…¥</h5>
            <div class="input-group">
                <textarea v-model="importJsonText" class="form-control" rows="1" placeholder='è²¼ä¸Š Gemini çµ¦çš„ JSON...'></textarea>
                <button @click="importFromJSON" class="btn btn-warning">åŒ¯å…¥åº«å­˜</button>
            </div>
            <div class="form-text small">åŒ¯å…¥å¾Œæœƒç›´æ¥åŠ å…¥ã€Œåº«å­˜ç¸½è¡¨ã€ï¼Œæ•¸é‡é è¨­ç‚º 0ã€‚</div>
        </div>

        <div class="card p-3" :class="{ loading: isAnalyzing }">
            <h5>ğŸ¤– åƒ¹æ ¼åˆ†æå™¨</h5>
            <div class="mb-2">
                <select v-model="selectedItemForAnalysis" class="form-select mb-2">
                    <option :value="null">-- é¸æ“‡è¦æŸ¥åƒ¹çš„ç¾æœ‰ç‰©å“ --</option>
                    <option v-for="item in inventory" :value="item">{{ item.name }}</option>
                </select>
                <textarea v-model="pastedText" class="form-control mb-2" rows="3" placeholder="è²¼ä¸Šç¶²é ä¸Šçš„å•†å“åƒ¹æ ¼æ–‡å­—..."></textarea>
                <button @click="analyzePrice" class="btn btn-success w-100" :disabled="!apiKey || !selectedItemForAnalysis">
                    {{ isAnalyzing ? 'åˆ†æä¸­...' : 'æ›´æ–°åƒ¹æ ¼' }}
                </button>
            </div>
        </div>
    </div>

    <div v-if="currentTab === 'utility'">
        <div class="card p-3">
            <h5>æ–°å¢ç´€éŒ„</h5>
            <div class="input-group mb-2">
                <select v-model="newBill.type" class="form-select" style="max-width:100px"><option>é›»è²»</option><option>æ°´è²»</option><option>ç…¤æ°£</option></select>
                <input v-model="newBill.date" type="date" class="form-control">
                <input v-model.number="newBill.amount" type="number" class="form-control" placeholder="$">
                <button @click="addBill" class="btn btn-primary">è¨˜</button>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-sm text-nowrap">
                    <thead><tr><th>é¡åˆ¥</th><th>æ—¥æœŸ</th><th>é‡‘é¡</th><th></th></tr></thead>
                    <tbody>
                        <tr v-for="(bill, index) in sortedBills" :key="index">
                            <td>{{ bill.type }}</td><td>{{ bill.date }}</td><td>${{ bill.amount }}</td>
                            <td><i @click="bills.splice(index, 1); saveData()" class="bi bi-x-circle text-danger" style="cursor:pointer"></i></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div v-if="currentTab === 'settings'">
        <div class="card p-3 mb-3">
            <h5>ğŸ”‘ Gemini API Key</h5>
            <input v-model="apiKey" type="password" class="form-control mb-2" placeholder="åœ¨æ­¤è²¼ä¸Š Key">
            <button @click="saveSettings" class="btn btn-success w-100">å„²å­˜è¨­å®š</button>
        </div>
        <div class="card p-3">
            <h5>ğŸ’¾ å‚™ä»½èˆ‡é‚„åŸ</h5>
            <button @click="exportData" class="btn btn-outline-primary w-100 mb-2">åŒ¯å‡ºå®Œæ•´å‚™ä»½ JSON</button>
            <input type="file" @change="importData" class="form-control">
        </div>
    </div>

    <div v-if="showAddModal || showEditModal" class="modal d-block" style="background: rgba(0,0,0,0.5)">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{ showEditModal ? 'ç·¨è¼¯ç‰©å“' : 'æ–°å¢ç‰©å“' }}</h5>
                    <button @click="closeModal" class="btn-close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2">
                        <label class="form-label">åˆ†é¡</label>
                        <select v-model="editingForm.categoryId" class="form-select">
                            <option v-for="cat in categories" :value="cat.id">{{ cat.id }} {{ cat.name }}</option>
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">åç¨±</label>
                        <input v-model="editingForm.name" class="form-control">
                    </div>
                    <div class="row g-2 mb-2">
                        <div class="col-6">
                            <label class="form-label">åº«å­˜</label>
                            <input v-model.number="editingForm.stock" type="number" class="form-control">
                        </div>
                        <div class="col-6">
                            <label class="form-label">åƒ¹æ ¼ ($)</label>
                            <input v-model.number="editingForm.latestPrice" type="number" class="form-control">
                        </div>
                    </div>
                    <div class="mb-2">
                        <label class="form-label">ISBN / æ¢ç¢¼</label>
                        <input v-model="editingForm.isbn" class="form-control" placeholder="é¸å¡«">
                    </div>
                    <div class="mb-2">
                        <label class="form-label">ç¶²å€ URL</label>
                        <input v-model="editingForm.url" class="form-control" placeholder="é¸å¡«">
                    </div>
                </div>
                <div class="modal-footer">
                    <button @click="closeModal" class="btn btn-secondary">å–æ¶ˆ</button>
                    <button @click="saveItem" class="btn btn-primary">å„²å­˜</button>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            currentTab: 'inventory',
            apiKey: '',
            searchQuery: '',
            
            // è³‡æ–™
            inventory: [],
            bills: [],
            categories: [
                { id: '10', name: 'é£Ÿå“/ä¹¾ç³§' }, { id: '20', name: 'é£²å“' },
                { id: '30', name: 'å®¶å±…æ¸…æ½”' }, { id: '40', name: 'å€‹äººè­·ç†' },
                { id: '50', name: 'ç´™å“/è¡›ç”Ÿ' }, { id: '60', name: 'å»šæˆ¿ç”¨å“' },
                { id: '70', name: 'è—¥å“/ä¿å¥' }, { id: '99', name: 'å…¶ä»–' }
            ],

            // ç‹€æ…‹èˆ‡é¸å–
            selectedIds: [], // å„²å­˜è¢«å‹¾é¸çš„ item ID
            
            // ç·¨è¼¯/æ–°å¢è¡¨å–®
            showAddModal: false,
            showEditModal: false,
            editingForm: {},
            
            // Gemini ç›¸é—œ
            importJsonText: '',
            pastedText: '',
            isAnalyzing: false,
            selectedItemForAnalysis: null,
            newBill: { type: 'é›»è²»', date: '', amount: '' }
        };
    },
    computed: {
        // æœå°‹éæ¿¾é‚è¼¯
        filteredInventory() {
            const query = this.searchQuery.toLowerCase().trim();
            if (!query) return this.inventory;
            return this.inventory.filter(item => {
                const matchName = item.name.toLowerCase().includes(query);
                const matchIsbn = item.isbn && item.isbn.includes(query);
                // æœå°‹åˆ†é¡åç¨± (ä¾‹å¦‚æ‰“ "é£²å“" ä¹Ÿèƒ½æœåˆ°)
                const catName = this.getCategoryName(item.categoryId).toLowerCase();
                const matchCat = catName.includes(query);
                return matchName || matchIsbn || matchCat;
            });
        },
        // å–å¾—ç›®å‰å‹¾é¸çš„å®Œæ•´ç‰©ä»¶
        selectedItems() {
            return this.inventory.filter(item => this.selectedIds.includes(item.id));
        },
        sortedBills() { return this.bills.sort((a, b) => new Date(b.date) - new Date(a.date)); }
    },
    mounted() { this.loadData(); },
    methods: {
        // --- åŸºæœ¬è³‡æ–™å­˜å– ---
        saveData() {
            localStorage.setItem('homeInventoryDB_v3', JSON.stringify({
                inventory: this.inventory, bills: this.bills, apiKey: this.apiKey
            }));
        },
        loadData() {
            // å˜—è©¦è®€å– v3ï¼Œè‹¥ç„¡å‰‡å˜—è©¦è®€å–èˆŠç‰ˆä¸¦é·ç§»
            let data = localStorage.getItem('homeInventoryDB_v3');
            let parsed = null;
            
            if (data) {
                parsed = JSON.parse(data);
            } else {
                // é·ç§»èˆŠç‰ˆè³‡æ–™ (v2 -> v3)
                const oldData = localStorage.getItem('homeInventoryDB_v2');
                if (oldData) {
                    const old = JSON.parse(oldData);
                    parsed = {
                        inventory: [...(old.inventory || []), ...(old.planningList || [])], // åˆä½µæ¸…å–®
                        bills: old.bills,
                        apiKey: old.apiKey
                    };
                    // å¹«èˆŠè³‡æ–™è£œä¸Š ID
                    parsed.inventory.forEach(item => { if(!item.id) item.id = Date.now() + Math.random().toString(36).substr(2, 9); });
                    alert('å·²è‡ªå‹•å‡ç´šè‡³ v3.0 ç‰ˆæœ¬ (åˆä½µè³‡æ–™åº«)');
                }
            }

            if (parsed) {
                this.inventory = parsed.inventory || [];
                this.bills = parsed.bills || [];
                this.apiKey = parsed.apiKey || '';
                // ç¢ºä¿æ¯å€‹ç‰©å“éƒ½æœ‰å”¯ä¸€ ID (çµ¦ Checkbox ç”¨)
                this.inventory.forEach(item => { if(!item.id) item.id = Date.now() + Math.random().toString(36).substr(2, 9); });
            }
        },
        saveSettings() { this.saveData(); alert('è¨­å®šå·²å„²å­˜ï¼'); },
        getCategoryName(id) {
            const cat = this.categories.find(c => c.id == id);
            return cat ? `${id}-${cat.name}` : id || 'æœªåˆ†é¡';
        },

        // --- é¸å–é‚è¼¯ ---
        isSelected(item) { return this.selectedIds.includes(item.id); },
        toggleSelection(item) {
            const id = item.id;
            if (this.selectedIds.includes(id)) {
                this.selectedIds = this.selectedIds.filter(i => i !== id);
            } else {
                this.selectedIds.push(id);
            }
        },
        selectAll(doSelect) {
            if (doSelect) {
                this.selectedIds = this.filteredInventory.map(i => i.id);
            } else {
                this.selectedIds = [];
            }
        },

        // --- æµ®å‹•é¸å–®æ“ä½œ ---
        actionEdit() {
            if (this.selectedItems.length !== 1) return;
            this.editingForm = JSON.parse(JSON.stringify(this.selectedItems[0])); // æ·±æ‹·è²
            this.showEditModal = true;
        },
        actionCopy() {
            const text = this.selectedItems.map(i => 
                `ğŸ“Œ ${i.name}\n   åº«å­˜: ${i.stock} | åƒ¹æ ¼: $${i.latestPrice || '-'}\n   é€£çµ: ${i.url || 'ç„¡'}`
            ).join('\n\n');
            navigator.clipboard.writeText(text).then(() => alert('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿'));
        },
        actionWhatsApp() {
            const text = "éœ€è³¼è²·/åº«å­˜æ¸…å–®ï¼š\n" + this.selectedItems.map(i => 
                `- ${i.name} (åº«å­˜:${i.stock})`
            ).join('\n');
            const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        },
        actionCSV() {
            let csv = "\uFEFFåç¨±,åˆ†é¡,åº«å­˜,åƒ¹æ ¼,å‚™è¨»\n"; // \uFEFF è§£æ±º Excel äº‚ç¢¼
            this.selectedItems.forEach(i => {
                csv += `"${i.name}","${this.getCategoryName(i.categoryId)}",${i.stock},${i.latestPrice || 0},"${i.unitPrice || ''}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "inventory_list.csv";
            link.click();
        },
        actionDelete() {
            if(!confirm(`ç¢ºå®šåˆªé™¤é€™ ${this.selectedItems.length} å€‹é …ç›®å—ï¼Ÿ`)) return;
            this.inventory = this.inventory.filter(item => !this.selectedIds.includes(item.id));
            this.selectedIds = [];
            this.saveData();
        },

        // --- ç·¨è¼¯/æ–°å¢é‚è¼¯ ---
        updateStock(item, change) {
            item.stock = (item.stock || 0) + change;
            if(item.stock < 0) item.stock = 0;
            this.saveData();
        },
        closeModal() { this.showAddModal = false; this.showEditModal = false; this.editingForm = {}; },
        saveItem() {
            if (!this.editingForm.name) return alert('åç¨±å¿…å¡«');
            
            if (this.showEditModal) {
                // æ›´æ–°ç¾æœ‰
                const index = this.inventory.findIndex(i => i.id === this.editingForm.id);
                if (index !== -1) {
                    this.inventory[index] = { ...this.editingForm };
                }
            } else {
                // æ–°å¢
                this.editingForm.id = Date.now().toString();
                if(this.editingForm.stock === undefined) this.editingForm.stock = 1;
                if(!this.editingForm.categoryId) this.editingForm.categoryId = '99';
                this.inventory.push({ ...this.editingForm });
            }
            this.saveData();
            this.closeModal();
            this.selectedIds = []; // æ¸…ç©ºé¸å–
        },

        // --- åŒ¯å…¥ ---
        importFromJSON() {
            try {
                if (!this.importJsonText) return;
                const newItems = JSON.parse(this.importJsonText);
                if (Array.isArray(newItems)) {
                    newItems.forEach(item => {
                        item.id = Date.now() + Math.random().toString(36).substr(2, 9);
                        item.stock = 0; // åŒ¯å…¥é è¨­åº«å­˜ 0
                        if(!item.categoryId) item.categoryId = '99';
                    });
                    this.inventory.push(...newItems);
                    this.importJsonText = '';
                    this.saveData();
                    alert(`æˆåŠŸåŒ¯å…¥ ${newItems.length} å€‹é …ç›®ï¼`);
                }
            } catch (e) { alert('JSON æ ¼å¼éŒ¯èª¤'); }
        },
        // --- æ ¼åƒ¹ ---
        async analyzePrice() {
            if (!this.pastedText || !this.apiKey) return alert('è«‹å¡«å¯«å®Œæ•´');
            this.isAnalyzing = true;
            const prompt = `åˆ†æå•†å“æ–‡å­—: "${this.pastedText}"ï¼Œå›å‚³JSON: {"price": æ•¸å­—, "unitPrice": "ç°¡çŸ­å‚™è¨»å¦‚ 2/åŒ…"}`;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${this.apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                const result = JSON.parse(aiText.replace(/```json|```/g, '').trim());
                
                // æ›´æ–°é¸å®šçš„ç‰©å“
                this.selectedItemForAnalysis.latestPrice = result.price;
                this.selectedItemForAnalysis.unitPrice = result.unitPrice;
                this.saveData();
                alert(`æ›´æ–°æˆåŠŸï¼$${result.price}`);
            } catch (error) { alert('åˆ†æå¤±æ•—'); } finally { this.isAnalyzing = false; }
        },
        // --- å…¶ä»– ---
        addBill() { this.bills.push({ ...this.newBill }); this.saveData(); },
        exportData() {
            const str = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify({ inventory: this.inventory, bills: this.bills, apiKey: this.apiKey }));
            const a = document.createElement('a'); a.href = str; a.download = "backup_v3.json";
            document.body.appendChild(a); a.click(); a.remove();
        },
        importData(e) {
            const reader = new FileReader();
            reader.onload = (event) => {
                const p = JSON.parse(event.target.result);
                this.inventory = p.inventory || [];
                this.bills = p.bills || []; 
                this.apiKey = p.apiKey || '';
                this.saveData();
                alert('å‚™ä»½é‚„åŸæˆåŠŸ');
            };
            reader.readAsText(e.target.files[0]);
        }
    }
}).mount('#app');
</script>
</body>
</html>
